<project name="Reorder" default="compile" basedir=".">
  <description>
    Reorder modules
  </description>

  <dirname
    property="reorder_build_dir"
    file="${ant.file.Reorder}"
  />

  <!-- Floodlight locations -->
  <property
      name="floodlight_jar_dir"
      location="${reorder_build_dir}/../floodlight/target/"/>

  <property
      name="floodlight_jar"
      location="${floodlight_jar_dir}/floodlight.jar"/>

  <!-- Where to store java class files -->
  <property
      name="reorder_classes_dir"
      location="${reorder_build_dir}/classes/"/>
  
  <property
      name="src_dir"
      location="${reorder_build_dir}/../src/"/>

  <property
      name="floodlight_modules_file"
      location="${reorder_build_dir}/floodlight_modules/floodlight.modules"/>
  
  
  <!-- Sets up initial directories -->
  <target name="init" description="setup build directories">
    <echo message="Setting up build directories for pronghorn"/>
    <mkdir dir="${reorder_classes_dir}"/>
  </target>


  <target name="compile_reorder_package"
          depends="init"
          description="compile reorder package">
    <!-- Compile all ralph java to bytecode -->
    <javac
        srcdir="${src_dir}"
        destdir="${reorder_classes_dir}"
        classpath="${floodlight_jar}"
        debug="true"
        debuglevel="lines,vars,source"
        includeantruntime="false" />
  </target>


  <!-- Run pronghorn connected to floodlight -->
  <property
      name="reorder_jar"
      value="reorder.jar"/>
  <target
      name="reorder_jar"
      depends="compile_reorder_package"
      description="Generate a jar for reorder testing.">
    <antcall target="make_jar">
      <param name="main_class" value="Reorder.Main"/>
      <param name="dest_jar" value="${reorder_jar}"/>
    </antcall>
  </target>

  

  <!-- Run pronghorn connected to floodlight -->
  <target
      name="make_jar"
      description="Make a jar">
    <jar destfile="${dest_jar}" filesetmanifest="mergewithoutmain">
      <manifest>
        <attribute name="Main-Class" value="${main_class}"/>
        <attribute name="Class-Path"
                   value="${reorder_classes_dir}:
                          ${floodlight_jar}"/>
      </manifest>
      <fileset dir="${reorder_classes_dir}"/>
      <fileset file="${floodlight_modules_file}"/>
      <zipgroupfileset dir="${floodlight_jar_dir}" includes="**/*.jar" />
    </jar>
  </target>

  
  <!-- Removes initial directories -->
  <target name="clean" description="get rid of build dir">
    <delete dir="${reorder_classes_dir}"/>
    <delete file="${reorder_jar}"/>
  </target>
  
</project>